<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="EmojiClickLOGO.png" type="image/png">
  <title>ğŸ–± Emoji Clicker Ultra â€“ Final Battle ğŸ”¥ğŸ˜</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(to bottom, #0f001a, #2a0050);
      color: #e8ecf2;
      text-align: center;
      padding: 15px;
      min-height: 100vh;
      overflow-x: hidden;
    }
    h1 { font-size: 1.8rem; margin: 20px 0; text-shadow: 0 0 15px #ff00ff; }
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,0,255,0.2);
      backdrop-filter: blur(12px);
      padding: 20px;
      margin: 20px auto;
      max-width: 600px;
      width: 95%;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(255,0,255,0.2);
    }
    button {
      background: linear-gradient(45deg, #2a0050, #500080);
      border: 1px solid #ff00ff88;
      color: #ffccff;
      padding: 14px 18px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.3s;
      box-shadow: 0 0 15px rgba(255,0,255,0.3);
      margin: 6px;
      min-width: 140px;
    }
    button:hover { transform: scale(1.08); }
    .shop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin: 10px 0; }
    #emoji {
      font-size: 130px;
      cursor: pointer;
      margin: 20px;
      animation: pulse 2s infinite, rainbow 10s infinite linear;
    }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    @keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
    #emoji:active { transform: scale(1.3); }
    #progressBar {
      background: #200040;
      border: 1px solid #ff00ff;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin: 15px 0;
    }
    #progressFill {
      background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
      background-size: 200% 100%;
      animation: shimmer 3s infinite linear;
      height: 100%;
      width: 0%;
      transition: width 0.6s ease-out;
    }
    @keyframes shimmer { 0% { background-position: 0% 0; } 100% { background-position: 200% 0; } }
    #popContainer {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 350px;
      pointer-events: none;
      z-index: 100;
    }
    .popMessage {
      background: linear-gradient(45deg, #ff00ff44, #00ffff44);
      color: #fff;
      padding: 12px 16px;
      margin-top: 8px;
      border-radius: 15px;
      font-weight: bold;
      backdrop-filter: blur(10px);
      border: 1px solid #ff00ff66;
      box-shadow: 0 0 20px rgba(255,0,255,0.4);
      animation: floatPop 2.5s forwards;
    }
    @keyframes floatPop {
      0% { opacity:1; transform:translateY(0) scale(1); }
      50% { transform:translateY(-20px) scale(1.05); }
      100% { opacity:0; transform:translateY(-80px) scale(0.8); }
    }
    #particleContainer, #clickParticles { position:fixed; inset:0; pointer-events:none; z-index:1; }
    .particle, .clickParticle { position:absolute; font-size:30px; animation:explode 1.5s forwards; pointer-events:none; }
    @keyframes explode { 0%{opacity:1;transform:scale(0)} 100%{opacity:0;transform:scale(2)translate(var(--dx),var(--dy))} }
    .clickParticle { font-size:28px; animation:clickFloat 1.2s forwards; }
    @keyframes clickFloat { 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-60px)} }
    .leaderboard-entry {
      padding:12px; margin:5px 0;
      background:rgba(255,255,255,0.05);
      border-radius:10px;
      border-left:4px solid #ff00ff;
    }
    .achievement {
      padding:12px; margin:8px 0;
      background:rgba(255,255,255,0.05);
      border-radius:10px;
      border-left:4px solid #888;
      opacity:0.6;
    }
    .achievement.unlocked {
      opacity:1;
      border-left:6px solid #ffd700;
      background:linear-gradient(45deg,#ffd70022,#ff00ff22);
      box-shadow:0 0 20px #ffd700;
    }
    /* Ban-Overlay â€“ groÃŸ, sofort sichtbar bei Ban */
    #banOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.96);
      color: #ff4444;
      font-size: 3rem;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
      z-index: 9999;
      flex-direction: column;
      gap: 40px;
      line-height: 1.4;
    }
    #banOverlay p { max-width: 90%; margin: 0; }
    @media (max-width:768px) {
      #emoji { font-size:110px; }
      button { padding:16px; font-size:1.1rem; }
      #banOverlay { font-size: 2.2rem; padding: 30px; }
    }
  </style>
</head>
<body>

<div id="particleContainer"></div>
<div id="popContainer"></div>
<div id="clickParticles"></div>

<!-- BAN OVERLAY -->
<div id="banOverlay">
  <p>Dein Account ist gesperrt.</p>
  <p style="font-size:1.8rem; color:#ff8888;">Rede mit dem Entwickler, um entbannt zu werden.</p>
</div>

<h1>ğŸ–± Emoji Clicker Ultra<br><small>Final Battle Edition ğŸ†ğŸ˜ˆ</small></h1>

<div class="card">
  <p>Klick das Emoji!</p>
  <div id="emoji">ğŸ˜€</div>
  <p>Punkte: <span id="score">0</span></p>
  <p>Power: <span id="power">1</span></p>
  <p>Stufe: <span id="level">1</span> (noch <span id="nextLevel">â€”</span>)</p>
  <div id="progressBar"><div id="progressFill"></div></div>
  <p>Auto/s: <span id="autoCount">0</span></p>
  <p>ğŸ‘¤ <span id="playerName">Lade...</span></p>
</div>

<div class="card">
  <p>ğŸ‘¥ Besuche gesamt: <span id="visits">â€”</span></p>
  <p>ğŸŸ¢ Spieler online: <span id="onlineCount">â€”</span></p>
</div>

<div class="card" id="leaderboardCard">
  <h2>ğŸ† Realtime Leaderboard (Top 10)</h2>
  <div id="leaderboardList">Lade Scores...</div>
</div>

<div class="card">
  <h2>âš¡ Power-Upgrades</h2>
  <div class="shop-grid">
    <button onclick="buyUpgrade(10,1)">+1 (10)</button>
    <button onclick="buyUpgrade(100,10)">+10 (100)</button>
    <button onclick="buyUpgrade(1000,100)">+100 (1k)</button>
    <button onclick="buyUpgrade(10000,1000)">+1k (10k)</button>
    <button onclick="buyUpgrade(100000,10000)">+10k (100k)</button>
    <button onclick="buyUpgrade(5000000,50000)">+50k (5 Mio)</button>
    <button onclick="buyUpgrade(25000000,250000)">+250k (25 Mio)</button>
    <button onclick="buyUpgrade(120000000,1000000)">+1 Mio (120 Mio)</button>
  </div>
</div>

<div class="card">
  <h2>ğŸ˜ Emoji-Unlocks</h2>
  <div class="shop-grid">
    <button onclick="unlockEmoji('ğŸ˜',50)">ğŸ˜ Cool</button>
    <button onclick="unlockEmoji('ğŸ±',200)">ğŸ± Cat</button>
    <button onclick="unlockEmoji('ğŸ”¥',500)">ğŸ”¥ Fire</button>
    <button onclick="unlockEmoji('ğŸ‰',2000)">ğŸ‰ Dragon</button>
    <button onclick="unlockEmoji('ğŸ¤¯',5000)">ğŸ¤¯ Boom</button>
    <button onclick="unlockEmoji('ğŸ¦„',10000)">ğŸ¦„ Unicorn</button>
    <button onclick="unlockEmoji('ğŸ‘½',25000)">ğŸ‘½ Alien</button>
    <button onclick="unlockEmoji('ğŸ’€',50000)">ğŸ’€ Boss</button>
  </div>
</div>

<div class="card">
  <h2>âœ¨ Boosts</h2>
  <div class="shop-grid">
    <button onclick="buyAuto(1,200)">ğŸ¤– +1 Auto (200)</button>
    <button onclick="buyAuto(5,5000)">ğŸ¤– +5 Autos (5k)</button>
    <button onclick="buyAuto(10,25000)">ğŸ¤– +10 Autos (25k)</button>
    <button onclick="buyAuto(100,250000)">ğŸ¤– +100 Autos (250k)</button>
    <button onclick="buyAuto(1000,2500000)">ğŸ¤– +1000 Autos (2.5M)</button>
    <button onclick="buyDouble()">ğŸ’¥ x2 10s (750)</button>
    <button onclick="buyLucky()">ğŸ€ x5 15s (250000)</button>
    <button onclick="buyLuckyX6()">ğŸ€ x6 12s (1.5 Mio)</button>
    <button onclick="buyLuckyX8()">ğŸ€ x8 10s (8 Mio)</button>
    <button onclick="buyRain()">ğŸŒ§ Regen (3000)</button>
    <button onclick="buyBomb()">ğŸ’£ Bombe (7500)</button>
  </div>
</div>

<div class="card">
  <h2>ğŸ… Achievements</h2>
  <div id="achievementsList">Lade...</div>
</div>

<div class="card">
  <input id="nameInput" placeholder="Dein Name (max 15)" maxlength="15"
         style="padding:12px;width:60%;max-width:220px;border-radius:10px;border:1px solid #ff00ff;background:#200040;color:#ffccff;">
  <button onclick="changeName()">Name Ã¤ndern</button>
  <button onclick="resetGame()" style="background:#ff0066;">ğŸ”¥ Hard Reset</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FIREBASE CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey: "AIzaSyCAMvsWjBmDcH9JSiRtabwoOfHy0Pin6Jk",
  authDomain: "emojiclickleaderboard-c1444.firebaseapp.com",
  databaseURL: "https://emojiclickleaderboard-c1444-default-rtdb.firebaseio.com",
  projectId: "emojiclickleaderboard-c1444",
  storageBucket: "emojiclickleaderboard-c1444.firebasestorage.app",
  messagingSenderId: "961795380260",
  appId: "1:961795380260:web:c676c94a7faf8820b534b1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GAME STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let playerName = localStorage.getItem('playerName') || '';
let playerRef = null;
let score = 0;
let power = 1;
let level = 1;
let auto = 0;
let currentEmoji = 'ğŸ˜€';
let doubleActive = false;
let doubleTimeout = null;
let clickCount = 0;
let isBanned = false;

let crazyMode = false;
let crazyInterval = null;
const crazyEmojis = ['ğŸ˜€','ğŸ˜','ğŸ¤©','ğŸ”¥','ğŸ’€','ğŸ‘½','ğŸ¦„','ğŸ‰','ğŸ¤¯','ğŸŒŸ','âš¡','ğŸ’¥','ğŸ‰','ğŸ†','ğŸ˜ˆ','ğŸ‘‘','ğŸ¤‘','ğŸš€','ğŸŒˆ','ğŸŒ€'];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DOM
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const emojiEl        = document.getElementById('emoji');
const scoreEl        = document.getElementById('score');
const powerEl        = document.getElementById('power');
const levelEl        = document.getElementById('level');
const nextEl         = document.getElementById('nextLevel');
const progressEl     = document.getElementById('progressFill');
const autoEl         = document.getElementById('autoCount');
const playerNameEl   = document.getElementById('playerName');
const leaderboardList = document.getElementById('leaderboardList');
const achievementsList = document.getElementById('achievementsList');
const visitsEl       = document.getElementById('visits');
const onlineCountEl  = document.getElementById('onlineCount');
const banOverlay     = document.getElementById('banOverlay');

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ACHIEVEMENTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const achievements = [
  {id:'firstClick', name:'Erster Klick', desc:'Klicke einmal', req:()=>clickCount>=1, icon:'ğŸ‘†'},
  {id:'score10k', name:'Zehntausender', desc:'10.000 Punkte', req:()=>score>=10000, icon:'ğŸ’°'},
  {id:'score100k', name:'Hunderttausender', desc:'100.000 Punkte', req:()=>score>=100000, icon:'ğŸ’'},
  {id:'level20', name:'Level 20', desc:'Stufe 20 erreichen', req:()=>level>=20, icon:'ğŸ“ˆ'},
  {id:'auto50', name:'Roboter-Armee', desc:'50 Autos besitzen', req:()=>auto>=50, icon:'ğŸ¤–'},
  {id:'click1000', name:'Klick-Wahnsinn', desc:'1.000 Klicks', req:()=>clickCount>=1000, icon:'ğŸ–±ï¸'},
  {id:'million', name:'MillionÃ¤r', desc:'1 Million Punkte', req:()=>score>=1e6, icon:'ğŸ¤‘'},
  {id:'level50', name:'LegendÃ¤r', desc:'Stufe 50 erreichen', req:()=>level>=50, icon:'ğŸ‘‘'},
  {id:'billion', name:'MilliardÃ¤r', desc:'1 Milliarde Punkte', req:()=>score>=1e9, icon:'ğŸŒŸ'},
  {id:'clickMaster', name:'Klick-Gott', desc:'25.000 Klicks', req:()=>clickCount>=25000, icon:'ğŸ–±ï¸', hidden:true},
  {id:'autoKing', name:'Auto-KÃ¶nig', desc:'500 Autos', req:()=>auto>=500, icon:'ğŸ¤–', hidden:true},
  {id:'secretGalaxy', name:'Galaxie-Meister', desc:'Galaxy Emoji freigeschaltet', req:()=>currentEmoji==='ğŸŒŒ', icon:'ğŸŒŒ', hidden:true},
  {id:'click10k', name:'Klick-Maschine', desc:'10.000 Klicks', req:()=>clickCount>=10000, icon:'âš™ï¸'},
  {id:'click50k', name:'Klick-Legende', desc:'50.000 Klicks', req:()=>clickCount>=50000, icon:'ğŸª„'},
  {id:'clickMillion', name:'Klick-MilliardÃ¤r', desc:'1 Million Klicks', req:()=>clickCount>=1e6, icon:'ğŸ’¥'},
  {id:'level100', name:'Level 100', desc:'Stufe 100 erreichen', req:()=>level>=100, icon:'ğŸ”ï¸'},
  {id:'level200', name:'Unsterblich', desc:'Stufe 200 erreichen', req:()=>level>=200, icon:'â™¾ï¸', hidden:true},
  {id:'auto100', name:'Automatisierer', desc:'100 Autos besitzen', req:()=>auto>=100, icon:'ğŸ¦¾'},
  {id:'auto500', name:'Fabrikbesitzer', desc:'500 Autos besitzen', req:()=>auto>=500, icon:'ğŸ­'},
  {id:'auto2000', name:'Mega-KI', desc:'2.000 Autos besitzen', req:()=>auto>=2000, icon:'ğŸ¤–ğŸ”¥', hidden:true},
  {id:'score10M', name:'ZehnmillionÃ¤r', desc:'10 Millionen Punkte', req:()=>score>=1e7, icon:'ğŸ’¸'},
  {id:'score100M', name:'HundertmillionÃ¤r', desc:'100 Millionen Punkte', req:()=>score>=1e8, icon:'ğŸª™'},
  {id:'score1B', name:'MilliardÃ¤r II', desc:'1 Milliarde Punkte', req:()=>score>=1e9, icon:'ğŸ’ğŸŒŸ'},
  {id:'score10B', name:'ZehnmilliardÃ¤r', desc:'10 Milliarden Punkte', req:()=>score>=1e10, icon:'ğŸª'},
  {id:'power1k', name:'Powerhouse', desc:'1.000 Power erreichen', req:()=>power>=1000, icon:'âš¡'},
  {id:'power10k', name:'Gott der Kraft', desc:'10.000 Power erreichen', req:()=>power>=10000, icon:'ğŸŒ©ï¸', hidden:true},
  {id:'luckyX5', name:'GlÃ¼ckspilz', desc:'x5 GlÃ¼cksboost benutzt', req:()=> (window.luckyUses||0) >=1, icon:'ğŸ€'},
  {id:'luckyX8', name:'GlÃ¼cksgott', desc:'x8 GlÃ¼cksboost benutzt', req:()=> (window.luckyUses||0) >=1, icon:'ğŸ€ğŸ”¥', hidden:true},
  {id:'autoBought', name:'Erster Kauf', desc:'Ersten Auto-Upgrade gekauft', req:()=>auto>=1, icon:'ğŸ›’'}
];

let unlockedAchievements = new Set(JSON.parse(localStorage.getItem('unlockedAch')||'[]'));

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ACHIEVEMENT-FUNKTIONEN
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkAndUnlockAchievements() {
  if (isBanned) return;
  achievements.forEach(ach => {
    if (!unlockedAchievements.has(ach.id) && ach.req()) {
      unlockedAchievements.add(ach.id);
      localStorage.setItem('unlockedAch', JSON.stringify([...unlockedAchievements]));
      const prefix = ach.hidden ? 'GEHEIMER ' : '';
      showPop(`ğŸ† ${prefix}ERFOLG: ${ach.name}!`);
      renderAchievements();
      if (ach.id === 'billion') activateCrazyMode();
    }
  });
}

function renderAchievements() {
  achievementsList.innerHTML = '';
  achievements.forEach(ach => {
    const isUnlocked = unlockedAchievements.has(ach.id);
    const div = document.createElement('div');
    div.className = `achievement${isUnlocked ? ' unlocked' : ''}`;
    let displayName = isUnlocked || !ach.hidden ? ach.name : '???';
    div.innerHTML = `${ach.icon} <strong>${displayName}</strong><br><small>${ach.desc}</small>`;
    achievementsList.appendChild(div);
  });
}

function activateCrazyMode() {
  if (crazyMode || isBanned) return;
  crazyMode = true;
  showPop('ğŸŒ€ CRAZY MODE AKTIVIERT! Emoji wird WILD!');
  crazyInterval = setInterval(() => {
    emojiEl.textContent = crazyEmojis[Math.floor(Math.random()*crazyEmojis.length)];
  }, 80);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VISUAL EFFECTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function bgParticles() {
  if (isBanned) return;
  const p = document.createElement('div');
  p.className = 'particle';
  p.textContent = ['âœ¨','â­','ğŸ’œ','ğŸ”¥','ğŸ¦„'][Math.floor(Math.random()*5)];
  p.style.left = Math.random()*100 + 'vw';
  p.style.setProperty('--dx', (Math.random()-0.5)*240 + 'px');
  p.style.setProperty('--dy', (Math.random()-0.5)*240 + 'px');
  document.getElementById('particleContainer').appendChild(p);
  setTimeout(()=>p.remove(), 7000);
}
setInterval(bgParticles, 280);

function clickParticles(x, y) {
  if (isBanned) return;
  for (let i = 0; i < 16; i++) {
    const cp = document.createElement('div');
    cp.className = 'clickParticle';
    cp.textContent = ['ğŸ’¥','â­','âœ¨','ğŸ”¥','âš¡'][Math.floor(Math.random()*5)];
    cp.style.left = (x + Math.random()*50 - 25) + 'px';
    cp.style.top = (y + Math.random()*30 - 15) + 'px';
    document.getElementById('clickParticles').appendChild(cp);
    setTimeout(()=>cp.remove(), 1400);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CORE CLICK & UPDATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
emojiEl.onclick = (e) => {
  if (isBanned) return;
  clickCount++;
  const clickPower = doubleActive ? power * 2 : power;
  score += clickPower;
  clickParticles(e.clientX, e.clientY);
  updateUI();
  saveScoreToDB();
  recalculateLevel();
  checkAndUnlockAchievements();
};

function updateUI() {
  scoreEl.textContent = score.toLocaleString();
  powerEl.textContent = power.toLocaleString();
  autoEl.textContent = auto;
  if (!crazyMode) emojiEl.textContent = currentEmoji;
}

function saveScoreToDB() {
  if (!playerRef || isBanned) return;
  playerRef.update({
    score,
    power,
    level,
    auto,
    emoji: currentEmoji,
    name: playerName,
    lastActive: Date.now()
  });
}

function recalculateLevel() {
  if (isBanned) return;
  const newLevel = 1 + Math.floor(Math.sqrt(score / 800));
  const leveledUp = newLevel > level;
  if (leveledUp) {
    level = newLevel;
    power += level * 8;
    auto += Math.floor(level / 3);
    showPop(`ğŸ†™ Level Up! Stufe ${level}`);
  }
  const currentThreshold = Math.pow(level-1, 2) * 800;
  const nextThreshold = Math.pow(level, 2) * 800;
  const toNext = Math.max(0, nextThreshold - score);
  nextEl.textContent = toNext.toLocaleString();
  const progress = nextThreshold > currentThreshold
    ? ((score - currentThreshold) / (nextThreshold - currentThreshold)) * 100
    : 100;
  progressEl.style.width = Math.min(100, Math.max(0, progress)) + '%';
  levelEl.textContent = level;
  if (leveledUp) {
    updateUI();
    saveScoreToDB();
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LEADERBOARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let prevTopScore = 0;
db.ref('players').orderByChild('score').limitToLast(10).on('value', snap => {
  const entries = [];
  snap.forEach(child => {
    const v = child.val();
    if (v?.name && typeof v.score === 'number') entries.push(v);
  });
  if (entries.length === 0) {
    leaderboardList.innerHTML = '<div>Keine Spieler bisher...</div>';
    return;
  }
  entries.sort((a,b)=>b.score - a.score);
  const topNow = entries[0].score;
  prevTopScore = topNow;
  leaderboardList.innerHTML = '';
  entries.forEach((e,i)=>{
    const div = document.createElement('div');
    div.className = 'leaderboard-entry';
    div.innerHTML = `${i+1}. ${e.emoji||'ğŸ˜€'} <strong>${e.name}</strong> â€“ ${e.score.toLocaleString()} (Lv ${e.level||1})`;
    leaderboardList.appendChild(div);
  });
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SHOP â€“ blockiert bei Ban
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buyUpgrade(cost, amount) {
  if (isBanned || score < cost) return;
  score -= cost;
  power += amount;
  showPop(`âš¡ +${amount} Power!`);
  updateUI();
  saveScoreToDB();
  recalculateLevel();
}

function unlockEmoji(em, cost) {
  if (isBanned || score < cost) return;
  score -= cost;
  currentEmoji = em;
  showPop(`ğŸ˜ ${em} freigeschaltet!`);
  updateUI();
  saveScoreToDB();
}

function buyAuto(amount, cost) {
  if (isBanned || score < cost) return;
  score -= cost;
  auto += amount;
  showPop(`ğŸ¤– +${amount} Auto/s!`);
  updateUI();
  saveScoreToDB();
  checkAndUnlockAchievements();
}

function buyDouble() {
  if (isBanned || score < 750 || doubleActive) return;
  score -= 750;
  doubleActive = true;
  showPop('ğŸ’¥ x2 Power fÃ¼r 10 Sekunden!');
  clearTimeout(doubleTimeout);
  doubleTimeout = setTimeout(() => {
    doubleActive = false;
    showPop('x2 Boost abgelaufen');
  }, 10000);
  updateUI();
  saveScoreToDB();
}

function buyLucky() {
  if (isBanned || score < 250000) return;
  score -= 250000;
  window.luckyUses = (window.luckyUses || 0) + 1;
  showPop('ğŸ€ x5 GlÃ¼ck fÃ¼r 15 Sekunden!');
  updateUI();
  saveScoreToDB();
  checkAndUnlockAchievements();
}

function buyLuckyX6() {
  if (isBanned || score < 1500000) return;
  score -= 1500000;
  window.luckyUses = (window.luckyUses || 0) + 1;
  showPop('ğŸ€ x6 GlÃ¼ck fÃ¼r 12 Sekunden!');
  updateUI();
  saveScoreToDB();
  checkAndUnlockAchievements();
}

function buyLuckyX8() {
  if (isBanned || score < 8000000) return;
  score -= 8000000;
  window.luckyUses = (window.luckyUses || 0) + 1;
  showPop('ğŸ€ x8 GlÃ¼ck fÃ¼r 10 Sekunden!');
  updateUI();
  saveScoreToDB();
  checkAndUnlockAchievements();
}

function buyRain() { if (isBanned || score < 3000) return; score-=3000; showPop('ğŸŒ§ Emoji-Regen (in Arbeit)'); updateUI(); saveScoreToDB(); }
function buyBomb() { if (isBanned || score < 7500) return; score-=7500; showPop('ğŸ’£ Bombe (in Arbeit)'); updateUI(); saveScoreToDB(); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AUTO-CLICKER â€“ blockiert bei Ban
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(() => {
  if (isBanned || auto <= 0) return;
  const gain = doubleActive ? auto * 2 : auto;
  score += gain;
  updateUI();
  saveScoreToDB();
  recalculateLevel();
  checkAndUnlockAchievements();
}, 1000);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// POPUP + NAME + RESET
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPop(text) {
  if (isBanned) return;
  const pop = document.createElement('div');
  pop.className = 'popMessage';
  pop.textContent = text;
  document.getElementById('popContainer').appendChild(pop);
  setTimeout(()=>pop.remove(), 2600);
}

function changeName() {
  if (isBanned) return;
  const input = document.getElementById('nameInput');
  const newName = input.value.trim().slice(0,15);
  if (!newName || newName === playerName) return;

  // Alten Eintrag lÃ¶schen
  if (playerRef) {
    playerRef.remove();
  }

  playerName = newName;
  localStorage.setItem('playerName', newName);
  playerNameEl.textContent = newName;

  playerRef = db.ref('players/' + newName);
  playerRef.set({
    name: newName,
    score,
    power,
    level,
    auto,
    emoji: currentEmoji,
    lastActive: Date.now(),
    banned: false  // Neuer Account nicht gebannt
  });

  setupPresence();
  showPop(`Name geÃ¤ndert â†’ ${newName}`);
}

function resetGame() {
  if (isBanned) return;
  if (!confirm("Wirklich ALLES zurÃ¼cksetzen?")) return;
  score = 0; power = 1; level = 1; auto = 0; currentEmoji = 'ğŸ˜€';
  clickCount = 0; doubleActive = false; crazyMode = false;
  window.luckyUses = 0;
  clearInterval(crazyInterval);
  unlockedAchievements.clear();
  localStorage.removeItem('unlockedAch');
  localStorage.removeItem('playerName');
  if (playerRef) playerRef.remove();
  playerName = ''; playerRef = null;
  playerNameEl.textContent = 'Name eingeben!';
  updateUI();
  recalculateLevel();
  renderAchievements();
  showPop('Spiel hart zurÃ¼ckgesetzt ğŸ”¥');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOAD + BAN-CHECK (schnell & mit Debug)
function loadOwnData() {
  if (!playerRef) {
    console.warn("Kein playerRef â€“ warte auf Namen");
    return;
  }

  console.log("Lade Daten fÃ¼r Spieler:", playerName);

  playerRef.once('value').then(snap => {
    const data = snap.val() || {};
    console.log("Firebase-Antwort:", data);

    score        = Number(data.score)        || 0;
    power        = Number(data.power)        || 1;
    level        = Number(data.level)        || 1;
    auto         = Number(data.auto)         || 0;
    currentEmoji = data.emoji                || 'ğŸ˜€';

    // BAN-CHECK â€“ sehr tolerant
    const bannedValue = data.banned;
    isBanned = bannedValue === true || 
               bannedValue === "true" || 
               String(bannedValue).toLowerCase() === "true";

    console.log("â†’ Ist gebannt?", isBanned, " (Wert war:", bannedValue, ")");

    if (isBanned) {
      console.warn("BAN AKTIV â†’ Overlay wird sofort angezeigt");
      banOverlay.style.display = 'flex';
      // Sofort blockieren
      emojiEl.style.pointerEvents = 'none';
      document.querySelectorAll('button, input').forEach(el => {
        el.disabled = true;
        el.style.opacity = '0.35';
        el.style.pointerEvents = 'none';
      });
      showPop("âš ï¸ Account gesperrt â€“ Spiel blockiert");
      return;
    }

    // Normal weiter
    updateUI();
    recalculateLevel();
    renderAchievements();
    checkAndUnlockAchievements();
  }).catch(err => {
    console.error("Firebase Lade-Fehler:", err);
  });
}

function setupPresence() {
  if (!playerRef || isBanned) return;
  const connectedRef = db.ref('.info/connected');
  connectedRef.on('value', snap => {
    if (snap.val() === true) {
      onlineCountEl.textContent = 'â€”';
      db.ref('online/' + playerRef.key).onDisconnect().remove();
      db.ref('online/' + playerRef.key).set(true);
    }
  });
  db.ref('online').on('value', snap => {
    const count = snap.numChildren();
    onlineCountEl.textContent = count > 0 ? count : 'â€”';
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (playerName) {
  playerNameEl.textContent = playerName;
  document.getElementById('nameInput').value = playerName;
  playerRef = db.ref('players/' + playerName);
  loadOwnData();
  setupPresence();
} else {
  playerNameEl.textContent = 'Name eingeben!';
}

db.ref('stats/visits').transaction(c => (c || 0) + 1);
db.ref('stats/visits').on('value', s => {
  visitsEl.textContent = (s.val() || 0).toLocaleString();
});

recalculateLevel();
renderAchievements();
checkAndUnlockAchievements();
showPop('ğŸ® Willkommen zu EmojiClick! ğŸ”¥');
</script>
</body>
</html>