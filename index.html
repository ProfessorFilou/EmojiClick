<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ–± Emoji Clicker Ultra â€“ Final Battle ğŸ”¥ğŸ˜</title>
<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(to bottom, #0f001a, #2a0050);
  color: #e8ecf2;
  text-align: center;
  padding: 15px;
  min-height: 100vh;
  overflow-x: hidden;
}
h1 { font-size: 1.8rem; margin: 20px 0; text-shadow: 0 0 15px #ff00ff; }
.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,0,255,0.2);
  backdrop-filter: blur(12px);
  padding: 20px;
  margin: 20px auto;
  max-width: 600px;
  width: 95%;
  border-radius: 20px;
  box-shadow: 0 0 30px rgba(255,0,255,0.2);
  transition: all 0.3s;
}
button {
  background: linear-gradient(45deg, #2a0050, #500080);
  border: 1px solid #ff00ff88;
  color: #ffccff;
  padding: 14px 18px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1rem;
  transition: 0.3s;
  box-shadow: 0 0 15px rgba(255,0,255,0.3);
  margin: 6px;
  min-width: 140px;
  touch-action: manipulation;
}
button:hover { transform: scale(1.08); box-shadow: 0 0 25px rgba(255,0,255,0.5); }
.shop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin: 10px 0; }
#emoji {
  font-size: 130px;
  cursor: pointer;
  margin: 20px;
  animation: pulse 2s infinite, rainbow 10s infinite linear;
  transition: transform 0.1s ease-out;
  outline: none !important;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}
@keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
@keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
#emoji:active { transform: scale(1.3); }
#progressBar {
  background: #200040;
  border: 1px solid #ff00ff;
  height: 20px;
  border-radius: 10px;
  overflow: hidden;
  margin: 15px 0;
}
#progressFill {
  background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
  background-size: 200% 100%;
  animation: shimmer 3s infinite linear;
  height: 100%;
  width: 0%;
  transition: width 0.8s ease;
}
@keyframes shimmer { 0% { background-position: 0% 0; } 100% { background-position: 200% 0; } }
#popContainer {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 350px;
  pointer-events: none;
  z-index: 100;
}
.popMessage {
  background: linear-gradient(45deg, #ff00ff44, #00ffff44);
  color: #fff;
  padding: 12px 16px;
  margin-top: 8px;
  border-radius: 15px;
  font-weight: bold;
  backdrop-filter: blur(10px);
  border: 1px solid #ff00ff66;
  box-shadow: 0 0 20px rgba(255,0,255,0.4);
  animation: floatPop 2.5s forwards;
}
@keyframes floatPop {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  50% { transform: translateY(-20px) scale(1.05); }
  100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
}
#particleContainer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
.particle { position: absolute; font-size: 30px; animation: explode 1.5s forwards; pointer-events: none; }
@keyframes explode { 0% { opacity: 1; transform: scale(0); } 100% { opacity: 0; transform: scale(2) translate(var(--dx), var(--dy)); } }
#clickParticles { position: fixed; pointer-events: none; z-index: 50; width: 100vw; height: 100vh; }
.clickParticle { position: absolute; font-size: 28px; animation: clickFloat 1.2s forwards; pointer-events: none; }
@keyframes clickFloat { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-60px); } }
@keyframes shake { 0%,100% { transform: translateX(0); } 20% { transform: translateX(-10px); } 40% { transform: translateX(10px); } 60% { transform: translateX(-10px); } 80% { transform: translateX(10px); } }
.leaderboard-entry {
  padding: 12px;
  margin: 5px 0;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
  border-left: 4px solid #ff00ff;
  transition: all 0.6s ease;
  position: relative;
}
.leaderboard-entry.overtake-global {
  animation: overtakeGlobal 2s ease-out;
  box-shadow: 0 0 40px #ffd700;
}
@keyframes overtakeGlobal {
  0% { transform: scale(1); background: rgba(255,255,255,0.05); }
  30% { transform: scale(1.4) translateY(-25px); background: linear-gradient(45deg, #ffd700, #ff00ff); }
  70% { transform: scale(1.1) translateY(-8px); }
  100% { transform: scale(1); background: rgba(255,255,255,0.05); }
}
.achievement {
  padding: 12px;
  margin: 8px 0;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
  border-left: 4px solid #888;
  transition: all 0.8s ease;
  opacity: 0.6;
}
.achievement.unlocked {
  opacity: 1;
  border-left: 6px solid #ffd700;
  background: linear-gradient(45deg, #ffd70022, #ff00ff22);
  box-shadow: 0 0 20px #ffd700;
  animation: achievePop 1.5s ease;
}
@keyframes achievePop {
  0% { transform: scale(0.8); opacity: 0; }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); opacity: 1; }
}
@media (max-width: 768px) { #emoji { font-size: 110px; } button { padding: 16px; font-size: 1.1rem; } }
</style>
</head>
<body>
<div id="particleContainer"></div>
<div id="popContainer"></div>
<div id="clickParticles"></div>
<h1>ğŸ–± Emoji Clicker Ultra<br><small>Final Battle Edition ğŸ†ğŸ˜ˆ</small></h1>

<div class="card">
  <p>Klick das Emoji!</p>
  <div id="emoji">ğŸ˜€</div>
  <p>Punkte: <span id="score">0</span></p>
  <p>Power: <span id="power">1</span></p>
  <p>Stufe: <span id="level">1</span> (noch <span id="nextLevel">1000</span>)</p>
  <div id="progressBar"><div id="progressFill"></div></div>
  <p>Auto/s: <span id="autoCount">0</span></p>
  <p>ğŸ‘¤ <span id="playerName">Lade...</span></p>
</div>

<div class="card">
  <p>ğŸ‘¥ Besuche gesamt: <span id="visits">Lade...</span></p>
  <p>ğŸŸ¢ Spieler online: <span id="onlineCount">Lade...</span></p>
</div>

<div class="card" id="leaderboardCard">
  <h2>ğŸ† Realtime Leaderboard (Top 10)</h2>
  <div id="leaderboardList">Lade Scores...</div>
</div>

<div class="card">
  <h2>âš¡ Power-Upgrades</h2>
  <div class="shop-grid">
    <button onclick="buyUpgrade(10,1)">+1 Power (10)</button>
    <button onclick="buyUpgrade(100,10)">+10 (100)</button>
    <button onclick="buyUpgrade(1000,100)">+100 (1k)</button>
    <button onclick="buyUpgrade(10000,1000)">+1k (10k)</button>
    <button onclick="buyUpgrade(100000,10000)">+10k (100k)</button>
  </div>
</div>

<div class="card">
  <h2>ğŸ˜ Emoji-Unlocks</h2>
  <div class="shop-grid">
    <button onclick="unlockEmoji('ğŸ˜',50)">ğŸ˜ Cool</button>
    <button onclick="unlockEmoji('ğŸ±',200)">ğŸ± Cat</button>
    <button onclick="unlockEmoji('ğŸ”¥',500)">ğŸ”¥ Fire</button>
    <button onclick="unlockEmoji('ğŸ‰',2000)">ğŸ‰ Dragon</button>
    <button onclick="unlockEmoji('ğŸ¤¯',5000)">ğŸ¤¯ Boom</button>
    <button onclick="unlockEmoji('ğŸ¦„',10000)">ğŸ¦„ Unicorn</button>
    <button onclick="unlockEmoji('ğŸ‘½',25000)">ğŸ‘½ Alien</button>
    <button onclick="unlockEmoji('ğŸ’€',50000)">ğŸ’€ Boss</button>
  </div>
</div>

<div class="card">
  <h2>âœ¨ Boosts</h2>
  <div class="shop-grid">
    <button onclick="buyAuto()">ğŸ¤– +1 Auto (100)</button>
    <button onclick="buyDouble()">ğŸ’¥ x2 10s (500)</button>
    <button onclick="buyRain()">ğŸŒ§ Regen (2k)</button>
    <button onclick="buyBomb()">ğŸ’£ Bombe (5k)</button>
    <button onclick="buyLucky()">ğŸ€ x5 20s (10k)</button>
  </div>
</div>

<div class="card">
  <h2>ğŸ… Achievements</h2>
  <div id="achievementsList">Lade...</div>
</div>

<div class="card">
  <input id="nameInput" placeholder="Dein Name (max 15)" maxlength="15" style="padding:12px;width:70%;border-radius:10px;border:1px solid #ff00ff;background:#200040;color:#ffccff;">
  <button onclick="changeName()">Name Ã¤ndern</button>
  <button onclick="resetGame()" style="background:#ff0066;">ğŸ”¥ Hard Reset</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// === FIREBASE CONFIG ===
const firebaseConfig = {
  apiKey: "AIzaSyCAMvsWjBmDcH9JSiRtabwoOfHy0Pin6Jk",
  authDomain: "emojiclickleaderboard-c1444.firebaseapp.com",
  databaseURL: "https://emojiclickleaderboard-c1444-default-rtdb.firebaseio.com",
  projectId: "emojiclickleaderboard-c1444",
  storageBucket: "emojiclickleaderboard-c1444.firebasestorage.app",
  messagingSenderId: "961795380260",
  appId: "1:961795380260:web:c676c94a7faf8820b534b1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// === GAME STATE ===
let playerName = localStorage.getItem('playerName') || '';
let playerRef = null;
let score = 0;
let power = 1;
let level = 1;
let auto = 0;
let currentEmoji = 'ğŸ˜€';
let doubleActive = false;
let doubleTimeout = null;
let clickCount = 0; // FÃ¼r Achievements

// Special crazy emoji mode
let crazyMode = false;
let crazyInterval = null;
const crazyEmojis = ['ğŸ˜€','ğŸ˜','ğŸ¤©','ğŸ”¥','ğŸ’€','ğŸ‘½','ğŸ¦„','ğŸ‰','ğŸ¤¯','ğŸŒŸ','âš¡','ğŸ’¥','ğŸ‰','ğŸ†','ğŸ˜ˆ','ğŸ‘‘','ğŸ¤‘','ğŸš€','ğŸŒˆ','ğŸŒ€'];

// === DOM ELEMENTS ===
const emojiEl = document.getElementById('emoji');
const scoreEl = document.getElementById('score');
const powerEl = document.getElementById('power');
const levelEl = document.getElementById('level');
const nextEl = document.getElementById('nextLevel');
const progressEl = document.getElementById('progressFill');
const autoEl = document.getElementById('autoCount');
const playerNameEl = document.getElementById('playerName');
const leaderboardList = document.getElementById('leaderboardList');
const achievementsList = document.getElementById('achievementsList');
const visitsEl = document.getElementById('visits');
const onlineCountEl = document.getElementById('onlineCount');

// === ACHIEVEMENTS ===
const achievements = [
  { id: 'firstClick', name: 'Erster Klick', desc: 'Klicke einmal auf das Emoji', req: () => clickCount >= 1, icon: 'ğŸ‘†' },
  { id: 'score10k', name: 'Zehntausender', desc: 'Erreiche 10.000 Punkte', req: () => score >= 10000, icon: 'ğŸ’°' },
  { id: 'score100k', name: 'Hunderttausender', desc: 'Erreiche 100.000 Punkte', req: () => score >= 100000, icon: 'ğŸ’' },
  { id: 'level20', name: 'Level 20', desc: 'Erreiche Stufe 20', req: () => level >= 20, icon: 'ğŸ“ˆ' },
  { id: 'auto50', name: 'Roboter-Armee', desc: 'Besitze 50 Autos', req: () => auto >= 50, icon: 'ğŸ¤–' },
  { id: 'click1000', name: 'Klick-Wahnsinn', desc: 'Klicke 1.000 Mal', req: () => clickCount >= 1000, icon: 'ğŸ–±ï¸' },
  { id: 'million', name: 'MillionÃ¤r', desc: 'Erreiche 1 Million Punkte', req: () => score >= 1000000, icon: 'ğŸ¤‘' },
  { id: 'level50', name: 'LegendÃ¤r', desc: 'Erreiche Stufe 50', req: () => level >= 50, icon: 'ğŸ‘‘' },
  { id: 'billion', name: 'MilliardÃ¤r', desc: 'Erreiche 1 Milliarde Punkte (SEHR schwer)', req: () => score >= 1000000000, icon: 'ğŸŒŸ' },
  { id: 'ultimate', name: 'ULTIMATE CLICKER', desc: 'Erreiche 10 Milliarden Punkte (unvorstellbar schwer)', req: () => score >= 10000000000, icon: 'ğŸŒ€' }
];

let unlockedAchievements = new Set(JSON.parse(localStorage.getItem('unlockedAch') || '[]'));

function checkAndUnlockAchievements() {
  achievements.forEach(ach => {
    if (!unlockedAchievements.has(ach.id) && ach.req()) {
      unlockedAchievements.add(ach.id);
      localStorage.setItem('unlockedAch', JSON.stringify([...unlockedAchievements]));
      showPop(`ğŸ† ERFOLG: ${ach.name}!`);
      renderAchievements();

      // Special reward fÃ¼r die schwersten
      if (ach.id === 'billion' || ach.id === 'ultimate') {
        activateCrazyMode();
      }
    }
  });
}

function renderAchievements() {
  achievementsList.innerHTML = '';
  achievements.forEach(ach => {
    const div = document.createElement('div');
    div.className = 'achievement' + (unlockedAchievements.has(ach.id) ? ' unlocked' : '');
    div.innerHTML = `${ach.icon} <strong>${ach.name}</strong><br><small>${ach.desc}</small>`;
    achievementsList.appendChild(div);
  });
}

function activateCrazyMode() {
  if (crazyMode) return;
  crazyMode = true;
  showPop('ğŸŒ€ CRAZY MODE AKTIVIERT! Dein Emoji ist jetzt WILD!');
  crazyInterval = setInterval(() => {
    emojiEl.textContent = crazyEmojis[Math.floor(Math.random() * crazyEmojis.length)];
  }, 80); // Super schnelles Wechseln
}

// === PARTIKEL & CLICK ===
function bgParticles() {
  const p = document.createElement('div');
  p.className = 'particle';
  p.textContent = ['âœ¨','â­','ğŸ’œ','ğŸ”¥','ğŸ¦„'][Math.floor(Math.random()*5)];
  p.style.left = Math.random()*100 + 'vw';
  p.style.setProperty('--dx', (Math.random()-0.5)*200 + 'px');
  p.style.setProperty('--dy', (Math.random()-0.5)*200 + 'px');
  document.getElementById('particleContainer').appendChild(p);
  setTimeout(() => p.remove(), 7000);
}
setInterval(bgParticles, 300);

function clickParticles(x, y) {
  for(let i = 0; i < 18; i++) {
    const cp = document.createElement('div');
    cp.className = 'clickParticle';
    cp.textContent = ['ğŸ’¥','â­','âœ¨','ğŸ”¥','âš¡'][Math.floor(Math.random()*5)];
    cp.style.left = x + Math.random()*40 - 20 + 'px';
    cp.style.top = y + 'px';
    document.getElementById('clickParticles').appendChild(cp);
    setTimeout(() => cp.remove(), 1200);
  }
}

// === GAME LOGIC ===
emojiEl.onclick = (e) => {
  clickCount++;
  const clickPower = doubleActive ? power * 2 : power;
  score += clickPower;
  clickParticles(e.clientX, e.clientY);
  updateUI();
  saveScoreToDB();
  recalculateLevel();
  checkAndUnlockAchievements();
};

function updateUI() {
  scoreEl.textContent = score.toLocaleString();
  powerEl.textContent = power.toLocaleString();
  autoEl.textContent = auto;
  if (!crazyMode) emojiEl.textContent = currentEmoji;
}

function saveScoreToDB() {
  if (playerRef) {
    playerRef.child('score').set(score);
  }
}

// Progressbalken wieder voll funktionsfÃ¤hig (wie ursprÃ¼nglich)
function recalculateLevel() {
  const newLevel = 1 + Math.floor(Math.sqrt(score / 1000));
  if (newLevel > level) {
    level = newLevel;
    power += level * 10;
    auto += Math.floor(level / 2);
    levelEl.textContent = level;
    updateUI();
    if (playerRef) playerRef.update({ level, power, auto });
    showPop('ğŸ†™ Level Up! Stufe ' + level);
  }

  const currentThreshold = Math.pow(level - 1, 2) * 1000;
  const nextThreshold = Math.pow(level, 2) * 1000;
  nextEl.textContent = Math.max(0, nextThreshold - score).toLocaleString();

  const progress = ((score - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
  progressEl.style.width = Math.clamp(0, 100, progress) + '%';
}

// === LEADERBOARD â€“ NUR SHAKE BEI NEUEM #1-REKORD, KEINE POSITION-ANIMATION ===
let prevTopScore = 0;

db.ref('players').orderByChild('score').limitToLast(10).on('value', (snap) => {
  const entries = [];
  snap.forEach(child => {
    const val = child.val();
    if (val && val.name && typeof val.score === 'number') entries.push(val);
  });

  if (entries.length === 0) {
    leaderboardList.innerHTML = '<div>Keine Spieler bisher...</div>';
    return;
  }

  entries.sort((a, b) => b.score - a.score);

  const currentTopScore = entries[0].score;

  // Shake NUR wenn der #1 einen neuen absoluten Rekord aufstellt
  if (currentTopScore > prevTopScore && prevTopScore > 0) {
    document.body.style.animation = 'shake 0.6s';
    setTimeout(() => document.body.style.animation = '', 600);
    // Goldene Animation nur fÃ¼r den neuen #1
    setTimeout(() => {
      const firstEntry = leaderboardList.firstChild;
      if (firstEntry) firstEntry.classList.add('overtake-global');
    }, 100);
  }
  prevTopScore = currentTopScore;

  leaderboardList.innerHTML = '';
  entries.forEach((entry, i) => {
    const div = document.createElement('div');
    div.className = 'leaderboard-entry';
    div.innerHTML = `${i+1}. ${entry.emoji || 'ğŸ˜€'} <strong>${entry.name}</strong> â€“ ${entry.score.toLocaleString()} Punkte (Stufe ${entry.level || 1})`;
    leaderboardList.appendChild(div);
  });
});

// === SHOP ===
function buyUpgrade(cost, amount) {
  if (score >= cost) {
    score -= cost;
    power += amount;
    showPop(`âš¡ +${amount} Power!`);
    updateUI(); saveScoreToDB(); recalculateLevel();
    if (playerRef) playerRef.update({ power });
  }
}

function unlockEmoji(em, cost) {
  if (score >= cost) {
    score -= cost;
    currentEmoji = em;
    showPop(`ğŸ˜ ${em} freigeschaltet!`);
    updateUI(); saveScoreToDB();
    if (playerRef) playerRef.update({ emoji: em });
  }
}

function buyAuto() {
  if (score >= 100) {
    score -= 100;
    auto++;
    showPop('ğŸ¤– +1 Auto/s!');
    updateUI(); saveScoreToDB();
    if (playerRef) playerRef.update({ auto });
  }
}

function buyDouble() {
  if (score >= 500 && !doubleActive) {
    score -= 500;
    doubleActive = true;
    showPop('ğŸ’¥ x2 Power fÃ¼r 10 Sekunden!');
    clearTimeout(doubleTimeout);
    doubleTimeout = setTimeout(() => {
      doubleActive = false;
      showPop('ğŸ’¥ x2 Boost abgelaufen');
    }, 10000);
  }
}

function buyRain() { showPop('ğŸŒ§ Emoji-Regen kommt bald!'); }
function buyBomb() { showPop('ğŸ’£ Bombe kommt bald!'); }
function buyLucky() { showPop('ğŸ€ Lucky x5 kommt bald!'); }

// === AUTO CLICKER ===
setInterval(() => {
  if (auto > 0) {
    const gain = doubleActive ? auto * 2 : auto;
    score += gain;
    updateUI();
    saveScoreToDB();
    recalculateLevel();
    checkAndUnlockAchievements();
  }
}, 1000);

// === POP ===
function showPop(text) {
  const pop = document.createElement('div');
  pop.className = 'popMessage';
  pop.textContent = text;
  document.getElementById('popContainer').appendChild(pop);
  setTimeout(() => pop.remove(), 2500);
}

// === NAME & RESET (wie vorher â€“ stabil) ===
function changeName() { /* alter Code â€“ unverÃ¤ndert */ }
function cleanupPlayerData() { /* alter Code */ }
function loadOwnData() { /* alter Code */ }
function setupPresence() { /* alter Code */ }
function resetGame() { /* alter Code */ }

// === INIT ===
Math.clamp = (min, max, val) => Math.min(max, Math.max(min, val));

if (playerName) {
  playerNameEl.textContent = playerName;
  document.getElementById('nameInput').value = playerName;
  playerRef = db.ref('players/' + playerName);
  loadOwnData();
  setupPresence();
} else {
  playerNameEl.textContent = 'Name eingeben!';
}

db.ref('stats/visits').transaction(c => (c || 0) + 1);
db.ref('stats/visits').on('value', s => visitsEl.textContent = (s.val() || 0).toLocaleString());

recalculateLevel();
renderAchievements();
checkAndUnlockAchievements();
showPop('ğŸ® Willkommen zurÃ¼ck! Der Fortschrittsbalken ist wieder da ğŸ”¥');
</script>
</body>
</html>