<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ–± Emoji Clicker Ultra â€“ Final Battle ğŸ”¥ğŸ˜</title>
<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(to bottom, #0f001a, #2a0050);
  color: #e8ecf2;
  text-align: center;
  padding: 15px;
  min-height: 100vh;
  overflow-x: hidden;
}
h1 { font-size: 1.8rem; margin: 20px 0; text-shadow: 0 0 15px #ff00ff; }
.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,0,255,0.2);
  backdrop-filter: blur(12px);
  padding: 20px;
  margin: 20px auto;
  max-width: 600px;
  width: 95%;
  border-radius: 20px;
  box-shadow: 0 0 30px rgba(255,0,255,0.2);
  transition: all 0.3s;
}
button {
  background: linear-gradient(45deg, #2a0050, #500080);
  border: 1px solid #ff00ff88;
  color: #ffccff;
  padding: 14px 18px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1rem;
  transition: 0.3s;
  box-shadow: 0 0 15px rgba(255,0,255,0.3);
  margin: 6px;
  min-width: 140px;
  touch-action: manipulation;
}
button:hover { transform: scale(1.08); box-shadow: 0 0 25px rgba(255,0,255,0.5); }
.shop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin: 10px 0; }
#emoji {
  font-size: 130px;
  cursor: pointer;
  margin: 20px;
  animation: pulse 2s infinite, rainbow 10s infinite linear;
  transition: transform 0.1s ease-out;
  outline: none !important;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}
@keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
@keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
#emoji:active { transform: scale(1.3); }
#progressBar {
  background: #200040;
  border: 1px solid #ff00ff;
  height: 20px;
  border-radius: 10px;
  overflow: hidden;
  margin: 15px 0;
}
#progressFill {
  background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
  background-size: 200% 100%;
  animation: shimmer 3s infinite linear;
  height: 100%;
  width: 0%;
  transition: width 0.8s ease;
}
@keyframes shimmer { 0% { background-position: 0% 0; } 100% { background-position: 200% 0; } }
#popContainer {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 350px;
  pointer-events: none;
  z-index: 100;
}
.popMessage {
  background: linear-gradient(45deg, #ff00ff44, #00ffff44);
  color: #fff;
  padding: 12px 16px;
  margin-top: 8px;
  border-radius: 15px;
  font-weight: bold;
  backdrop-filter: blur(10px);
  border: 1px solid #ff00ff66;
  box-shadow: 0 0 20px rgba(255,0,255,0.4);
  animation: floatPop 2.5s forwards;
}
@keyframes floatPop {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  50% { transform: translateY(-20px) scale(1.05); }
  100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
}
#particleContainer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
.particle { position: absolute; font-size: 30px; animation: explode 1.5s forwards; pointer-events: none; }
@keyframes explode { 0% { opacity: 1; transform: scale(0); } 100% { opacity: 0; transform: scale(2) translate(var(--dx), var(--dy)); } }
#clickParticles { position: fixed; pointer-events: none; z-index: 50; width: 100vw; height: 100vh; }
.clickParticle { position: absolute; font-size: 28px; animation: clickFloat 1.2s forwards; pointer-events: none; }
@keyframes clickFloat { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-60px); } }
@keyframes shake { 0%,100% { transform: translateX(0); } 20% { transform: translateX(-10px); } 40% { transform: translateX(10px); } 60% { transform: translateX(-10px); } 80% { transform: translateX(10px); } }
.leaderboard-entry {
  padding: 12px;
  margin: 5px 0;
  background: rgba(255,255,255,0.05);
  border-radius: 10px;
  border-left: 4px solid #ff00ff;
  transition: all 0.3s;
}
.leaderboard-entry.overtake {
  animation: overtakeAnim 2s ease-out;
  box-shadow: 0 0 40px #ffd700;
}
@keyframes overtakeAnim {
  0% { transform: scale(1); background: rgba(255,255,255,0.05); }
  30% { transform: scale(1.4) translateY(-25px); background: linear-gradient(45deg, #ffd700, #ff00ff); }
  70% { transform: scale(1.1) translateY(-8px); }
  100% { transform: scale(1); background: rgba(255,255,255,0.05); }
}
.achievement {
  padding: 10px;
  margin: 5px 0;
  background: rgba(0,0,0,0.3);
  border-radius: 10px;
  font-size: 0.9rem;
  opacity: 0.6;
  transition: opacity 0.5s, background 0.5s;
}
.achievement.unlocked {
  opacity: 1;
  background: linear-gradient(45deg, #ffd70044, #ff00ff44);
  box-shadow: 0 0 15px #ffd700;
}
@media (max-width: 768px) { #emoji { font-size: 110px; } button { padding: 16px; font-size: 1.1rem; } }
</style>
</head>
<body>
<div id="particleContainer"></div>
<div id="popContainer"></div>
<div id="clickParticles"></div>
<h1>ğŸ–± Emoji Clicker Ultra<br><small>Final Battle Edition ğŸ†ğŸ˜ˆ</small></h1>

<div class="card">
  <p>Klick das Emoji!</p>
  <div id="emoji">ğŸ˜€</div>
  <p>Punkte: <span id="score">0</span></p>
  <p>Power: <span id="power">1</span></p>
  <p>Stufe: <span id="level">1</span> (noch <span id="nextLevel">1000</span>)</p>
  <div id="progressBar"><div id="progressFill"></div></div>
  <p>Auto/s: <span id="autoCount">0</span></p>
  <p>ğŸ‘¤ <span id="playerName">Lade...</span></p>
</div>

<div class="card">
  <p>ğŸ‘¥ Besuche gesamt: <span id="visits">Lade...</span></p>
  <p>ğŸŸ¢ Spieler online: <span id="onlineCount">Lade...</span></p>
</div>

<div class="card" id="leaderboardCard">
  <h2>ğŸ† Realtime Leaderboard (Top 10)</h2>
  <div id="leaderboardList">Lade Scores...</div>
</div>

<div class="card">
  <h2>âš¡ Power-Upgrades</h2>
  <div class="shop-grid">
    <button onclick="buyUpgrade(10,1)">+1 Power (10)</button>
    <button onclick="buyUpgrade(100,10)">+10 (100)</button>
    <button onclick="buyUpgrade(1000,100)">+100 (1k)</button>
    <button onclick="buyUpgrade(10000,1000)">+1k (10k)</button>
    <button onclick="buyUpgrade(100000,10000)">+10k (100k)</button>
  </div>
</div>

<div class="card">
  <h2>ğŸ˜ Emoji-Unlocks</h2>
  <div class="shop-grid">
    <button onclick="unlockEmoji('ğŸ˜',50)">ğŸ˜ Cool</button>
    <button onclick="unlockEmoji('ğŸ±',200)">ğŸ± Cat</button>
    <button onclick="unlockEmoji('ğŸ”¥',500)">ğŸ”¥ Fire</button>
    <button onclick="unlockEmoji('ğŸ‰',2000)">ğŸ‰ Dragon</button>
    <button onclick="unlockEmoji('ğŸ¤¯',5000)">ğŸ¤¯ Boom</button>
    <button onclick="unlockEmoji('ğŸ¦„',10000)">ğŸ¦„ Unicorn</button>
    <button onclick="unlockEmoji('ğŸ‘½',25000)">ğŸ‘½ Alien</button>
    <button onclick="unlockEmoji('ğŸ’€',50000)">ğŸ’€ Boss</button>
  </div>
</div>

<div class="card">
  <h2>âœ¨ Boosts</h2>
  <div class="shop-grid">
    <button onclick="buyAuto()">ğŸ¤– +1 Auto (100)</button>
    <button onclick="buyDouble()">ğŸ’¥ x2 10s (500)</button>
    <button onclick="buyRain()">ğŸŒ§ Regen (2k)</button>
    <button onclick="buyBomb()">ğŸ’£ Bombe (5k)</button>
    <button onclick="buyLucky()">ğŸ€ x5 20s (10k)</button>
  </div>
</div>

<div class="card">
  <h2>ğŸ… Achievements</h2>
  <div id="achievementsList"></div>
</div>

<div class="card">
  <input id="nameInput" placeholder="Dein Name (max 15)" maxlength="15" style="padding:12px;width:70%;border-radius:10px;border:1px solid #ff00ff;background:#200040;color:#ffccff;">
  <button onclick="changeName()">Name Ã¤ndern</button>
  <button onclick="resetGame()" style="background:#ff0066;">ğŸ”¥ Hard Reset</button>
</div>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// === FIREBASE CONFIG ===
const firebaseConfig = {
  apiKey: "AIzaSyCAMvsWjBmDcH9JSiRtabwoOfHy0Pin6Jk",
  authDomain: "emojiclickleaderboard-c1444.firebaseapp.com",
  databaseURL: "https://emojiclickleaderboard-c1444-default-rtdb.firebaseio.com/",
  projectId: "emojiclickleaderboard-c1444",
  storageBucket: "emojiclickleaderboard-c1444.firebasestorage.app",
  messagingSenderId: "961795380260",
  appId: "1:961795380260:web:c676c94a7faf8820b534b1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// === GAME VARS ===
let playerName = localStorage.getItem('playerName') || '';
let playerRef = null;
let score = 0;
let power = 1;
let level = 1;
let auto = 0;
let currentEmoji = 'ğŸ˜€';

// === DOM ===
const emojiEl = document.getElementById('emoji');
const scoreEl = document.getElementById('score');
const powerEl = document.getElementById('power');
const levelEl = document.getElementById('level');
const nextEl = document.getElementById('nextLevel');
const progressEl = document.getElementById('progressFill');
const autoEl = document.getElementById('autoCount');
const playerNameEl = document.getElementById('playerName');
const leaderboardList = document.getElementById('leaderboardList');
const achievementsList = document.getElementById('achievementsList');
const visitsEl = document.getElementById('visits');
const onlineCountEl = document.getElementById('onlineCount');

// === PARTIKEL ===
function bgParticles() {
  const p = document.createElement('div');
  p.className = 'particle';
  p.textContent = ['âœ¨','â­','ğŸ’œ','ğŸ”¥','ğŸ¦„'][Math.floor(Math.random()*5)];
  p.style.left = Math.random()*100 + 'vw';
  p.style.setProperty('--dx', (Math.random()-0.5)*200 + 'px');
  p.style.setProperty('--dy', (Math.random()-0.5)*200 + 'px');
  document.getElementById('particleContainer').appendChild(p);
  setTimeout(() => p.remove(), 7000);
}
setInterval(bgParticles, 300);

function clickParticles(x, y) {
  for(let i=0; i<18; i++) {
    const cp = document.createElement('div');
    cp.className = 'clickParticle';
    cp.textContent = ['ğŸ’¥','â­','âœ¨','ğŸ”¥','âš¡'][Math.floor(Math.random()*5)];
    cp.style.left = x + Math.random()*40 - 20 + 'px';
    cp.style.top = y + 'px';
    document.getElementById('clickParticles').appendChild(cp);
    setTimeout(() => cp.remove(), 1200);
  }
}

// === CLICK ===
emojiEl.onclick = (e) => {
  score += power;
  clickParticles(e.clientX, e.clientY);
  scoreEl.textContent = score.toLocaleString();
  if (playerRef) playerRef.child('score').set(score);
  recalculateLevel();
};

// === LEVEL & PROGRESS ===
function recalculateLevel() {
  const newLevel = 1 + Math.floor(Math.sqrt(score / 1000));
  if (newLevel > level) {
    level = newLevel;
    power += level * 10;
    auto += Math.floor(level / 2);
    levelEl.textContent = level;
    powerEl.textContent = power.toLocaleString();
    autoEl.textContent = auto;
    if (playerRef) playerRef.update({ level, power, auto });
    showPop('ğŸ†™ Level Up! Stufe ' + level);
  }
  const currentThreshold = Math.pow(level - 1, 2) * 1000;
  const nextThreshold = Math.pow(level, 2) * 1000;
  nextEl.textContent = Math.max(0, nextThreshold - score).toLocaleString();
  const progress = ((score - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
  progressEl.style.width = Math.min(100, Math.max(0, progress)) + '%';
}

// === POP ===
function showPop(text) {
  const pop = document.createElement('div');
  pop.className = 'popMessage';
  pop.textContent = text;
  document.getElementById('popContainer').appendChild(pop);
  setTimeout(() => pop.remove(), 2500);
}

// === NAME Ã„NDERN ===
function changeName() {
  let newName = document.getElementById('nameInput').value.trim();
  if (!newName || newName === playerName) {
    showPop(newName ? 'Name unverÃ¤ndert' : 'âŒ Name eingeben!');
    return;
  }
  if (newName.length > 15) newName = newName.slice(0,15);

  // Alten Eintrag lÃ¶schen (falls existiert)
  if (playerRef) playerRef.remove();

  playerName = newName;
  localStorage.setItem('playerName', playerName);
  playerNameEl.textContent = playerName;
  document.getElementById('nameInput').value = playerName;

  playerRef = db.ref('players/' + playerName);
  playerRef.set({
    name: playerName,
    score: score,
    power: power,
    level: level,
    auto: auto,
    emoji: currentEmoji,
    timestamp: firebase.database.ServerValue.TIMESTAMP
  });

  // Presence & eigene Daten laden
  setupPresence();
  loadOwnData();

  showPop('Name geÃ¤ndert zu ' + playerName + '!');
}

// === EIGENE DATEN LADEN ===
function loadOwnData() {
  playerRef.on('value', (snap) => {
    const data = snap.val();
    if (data) {
      score = data.score || 0;
      power = data.power || 1;
      level = data.level || 1;
      auto = data.auto || 0;
      currentEmoji = data.emoji || 'ğŸ˜€';
      scoreEl.textContent = score.toLocaleString();
      powerEl.textContent = power.toLocaleString();
      autoEl.textContent = auto;
      emojiEl.textContent = currentEmoji;
      recalculateLevel();
    }
  });
}

// === ONLINE PRESENCE ===
function setupPresence() {
  const connectedRef = db.ref('.info/connected');
  const activeListRef = db.ref('activePlayers');

  connectedRef.on('value', (snap) => {
    if (snap.val() === true && playerName) {
      const myPresence = activeListRef.child(playerName);
      myPresence.set(true);
      myPresence.onDisconnect().remove();
    }
  });

  // Online Count
  activeListRef.on('value', (snap) => {
    onlineCountEl.textContent = snap.numChildren();
  });
}

// === VISITS COUNTER ===
db.ref('stats/visits').transaction(current => (current || 0) + 1);
db.ref('stats/visits').on('value', snap => {
  visitsEl.textContent = (snap.val() || 0).toLocaleString();
});

// === LEADERBOARD ===
let prevTopScore = 0;
db.ref('players').orderByChild('score').limitToLast(10).on('value', (snap) => {
  leaderboardList.innerHTML = '';
  const entries = [];
  snap.forEach(child => entries.push(child.val()));
  entries.sort((a, b) => b.score - a.score);

  const topScore = entries[0]?.score || 0;
  if (topScore > prevTopScore) {
    document.body.style.animation = 'shake 0.6s';
    setTimeout(() => document.body.style.animation = '', 600);
  }
  prevTopScore = topScore;

  if (entries.length === 0) {
    leaderboardList.innerHTML = '<div>Keine Spieler bisher...</div>';
    return;
  }

  entries.forEach((entry, i) => {
    const div = document.createElement('div');
    div.className = 'leaderboard-entry';
    div.innerHTML = `${i+1}. ${entry.emoji || 'ğŸ˜€'} <strong>${entry.name}</strong> â€“ ${entry.score.toLocaleString()} Punkte (Lv ${entry.level || 1})`;
    if (i === 0 && topScore > prevTopScore) div.classList.add('overtake');
    leaderboardList.appendChild(div);
  });
});

// === SHOP FUNKTIONEN ===
function buyUpgrade(cost, amount) {
  if (score >= cost) {
    score -= cost;
    power += amount;
    showPop(`âš¡ +${amount} Power!`);
    scoreEl.textContent = score.toLocaleString();
    powerEl.textContent = power.toLocaleString();
    if (playerRef) playerRef.update({ score, power });
    recalculateLevel();
  }
}

function unlockEmoji(em, cost) {
  if (score >= cost) {
    score -= cost;
    currentEmoji = em;
    showPop(`ğŸ˜ ${em} freigeschaltet!`);
    scoreEl.textContent = score.toLocaleString();
    emojiEl.textContent = em;
    if (playerRef) playerRef.update({ score, emoji: em });
  }
}

function buyAuto() {
  if (score >= 100) {
    score -= 100;
    auto++;
    showPop('ğŸ¤– +1 Auto!');
    scoreEl.textContent = score.toLocaleString();
    autoEl.textContent = auto;
    if (playerRef) playerRef.update({ score, auto });
  }
}

// Weitere Boosts bleiben gleich...
function buyDouble() { /* wie vorher */ }
function buyRain() { /* wie vorher */ }
function buyBomb() { /* wie vorher */ }
function buyLucky() { /* wie vorher */ }

// Du kannst die anderen Boost-Funktionen aus deinem alten Code hier einfÃ¼gen â€“ die funktionieren unverÃ¤ndert

// === AUTO CLICKER ===
setInterval(() => {
  if (auto > 0) {
    score += auto;
    scoreEl.textContent = score.toLocaleString();
    if (playerRef) playerRef.child('score').set(score);
    recalculateLevel();
  }
}, 1000);

// === ACHIEVEMENTS === (wie vorher â€“ unverÃ¤ndert)

// === RESET ===
function resetGame() {
  if (confirm('ALLES LÃ–SCHEN? Dein Account wird komplett aus dem Leaderboard entfernt!')) {
    if (playerRef) playerRef.remove();
    db.ref('activePlayers/' + playerName).remove();
    localStorage.clear();
    location.reload();
  }
}

// === INIT ===
if (playerName) {
  playerNameEl.textContent = playerName;
  document.getElementById('nameInput').value = playerName;
  playerRef = db.ref('players/' + playerName);
  loadOwnData();
  setupPresence();
} else {
  playerNameEl.textContent = 'Name eingeben!';
}

recalculateLevel();
updateAchievements(); // falls du die Funktion hast
showPop('ğŸ® Game ready â€“ viel SpaÃŸ beim Battlen!');
</script>
</body>
</html>